<!DOCTYPE>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic}" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head></head>
<body>

<div layout:fragment="content" class="container-fluid">


    <div class="p-3 align-items-center mb-4 ">

        <div class="mb-3 ">
            <h3 class="ml-3"><a th:href="@{/member/mypage}" class="text-black text-decoration-none">회원정보수정</a></h3>
        </div>

        <div class="container ">
            <div class="card-header align-items-center">비밀번호 확인하기</div>
            <div class="card-body text-center">

                <div class="input-group input-group-outline my-3 align-items-center">
                    <label class="form-label mb-0 mr-3 align-middle">비밀번호 확인</label>
                    <input type="password" id="password" name="password" class="form-control">
                </div>

            </div>
            <div class="justify-content-between d-flex" >
                <a th:href="@{/member/mypage}" class="btn btn-primary">뒤로가기</a>
                <button class="btn btn-primary" id="checkPwd">비밀번호 확인</button>
            </div>
        </div>
    </div>
</div>
<th:block layout:fragment="script">
    <script th:inline="javascript">
        $('#checkPwd').click(function () {
            const checkPassword = $('#password').val();
            /*<![CDATA[*/
            var id = /*[[ ${id} ]]*/;
            /*]]*/

            if (!checkPassword || checkPassword.trim() === "") {
                alert('비밀번호를 입력하세요.');
            } else {
                $.ajax({
                    type: 'GET',
                    url: '/member/checkpwd',
                    data: {'checkPassword': checkPassword},
                    dataType: "text"
                }).done(function (result) {
                    console.log("비밀번호 찾기");
                    console.log(typeof result)
                    console.log(result)
                    if (result === true || result === "true") {
                        console.log("비밀번호 일치");
                        window.location.href = "/member/edit/"+id;
                    } else if (result === false || result === "false") {
                        console.log('비밀번호 불일치');
                        alert('비밀번호가 맞지 않습니다.');
                        window.location.reload();
                    }
                }).fail(function (request, error) {
                    alert("code" + request.status + "\n message:" + request.responseText + "\n error:" + JSON.stringify(error));
                })
            }
        });

    </script>
</th:block>
</body>
</html>